pipeline {
    agent any
   
    stages {
       stage('Git checkout') {
           steps{
               cleanWs()
               checkout scm && sh 'pwd'
            }
        }

        stage('Validate packer file') {
            steps{
                sh "packer validate -var-file='automations/provisioning/packer/credentials.pkr.hcl' automations/provisioning/packer/ubuntu-server-22-04-docker/ubuntu-server-22-04-docker.pkr.hcl"
            }
        }

        stage('Build packer file') {
            steps{
                
                sh "packer build -var-file='automations/provisioning/packer/credentials.pkr.hcl' automations/provisioning/packer/ubuntu-server-22-04-docker/ubuntu-server-22-04-docker.pkr.hcl"
            }
        }

        stage('cleanup') {
            steps{
              cleanWs()
            }
        }
    }

        
}